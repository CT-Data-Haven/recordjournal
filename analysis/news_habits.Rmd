---
title: "News habits"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, warning = F, message = F)
```

```{r libraries}
library(tidyverse)
library(cwi)
library(janitor)
library(camiller)
source("../utils/plot_utils.R")
```

```{r paths}
path <- "../survey_data/01032023/"
plot_path <- "../distro/"
read <- read_csv(paste(path, "clean.csv", sep = "")) %>% 
  rename(age = big_age_band)
```

## Media used vs. Media preferred by total, age, and language at home

Overall totals not surprising. Strong preference for TV and social media. I think we can just look at "used."

```{r modes_used_preferred_total}
modes_a <- read %>% 
  select(formats_used) %>% 
  filter(!is.na(formats_used)) %>% 
  group_by(formats_used) %>% 
  count() %>% 
  ungroup() %>% 
  mutate(formats_used = if_else(n <=2, "Other", formats_used)) %>% 
  filter(formats_used != "Other") %>% 
  group_by(formats_used) %>% 
  summarise(n = sum(n)) %>% 
  rename(format = formats_used) %>% 
  mutate(mode = "used")

modes_b <- read %>% 
  select(formats_preferred) %>% 
  filter(!is.na(formats_preferred)) %>% 
  group_by(formats_preferred) %>% 
  count() %>% 
  ungroup() %>% 
  mutate(formats_preferred = if_else(n <=2, "Other", formats_preferred)) %>% 
  filter(formats_preferred != "Other") %>% 
  group_by(formats_preferred) %>% 
  summarise(n = sum(n)) %>% 
  rename(format = formats_preferred) %>% 
  mutate(mode = "preferred")

mode_bind <- bind_rows(modes_a, modes_b)

mode_bind %>% 
  ggplot(aes(x = n, y = reorder(format, n))) +
  geom_col() +
  geom_text(data = . %>% filter(n >= 50), aes(label = n), hjust = 1.2) +
  geom_text(data = . %>% filter(n < 50), aes(label = n), hjust = -.2, color = "black") +
  facet_grid(cols = vars(mode)) +
  labs(title = "Ways respondents prefer/use to get news", subtitle = "Respondents could select multiple ways", x = NULL, y = NULL) +
  theme(axis.text.x = element_blank())
```

I expected to see social media top the list for younger people. Social media just ekeing out ahead of TV for 30-49 year olds is interesting. We Milennials love a platform.

```{r modes_age}
agemode1 <- read %>% 
  select(formats_used, age) %>% 
  filter(!is.na(formats_used), !is.na(age)) %>% 
  group_by(formats_used, age) %>% 
  count() %>% 
  mutate(formats_used = if_else(n <=2, "Other", formats_used)) %>% 
  filter(formats_used != "Other") %>% 
  group_by(formats_used, age) %>% 
  summarise(n = sum(n)) %>% 
  ungroup() %>% 
  rename(format = formats_used) %>% 
  mutate(mode = "used")
# 
# agemode2 <- read %>% 
#   select(formats_preferred, age) %>% 
#   filter(!is.na(formats_preferred), !is.na(age)) %>% 
#   group_by(formats_preferred, age) %>% 
#   count() %>% 
#   mutate(formats_preferred = if_else(n <=2, "Other", formats_preferred)) %>% 
#   filter(formats_preferred != "Other") %>% 
#   group_by(formats_preferred, age) %>% 
#   summarise(n = sum(n)) %>% 
#   ungroup() %>% 
#   rename(format = formats_preferred) %>% 
#   mutate(mode = "preferred")
# 
# agemode_bind <- bind_rows(agemode1, agemode2)

agemode1 %>% 
  ggplot(aes(x = n, y = reorder(format, n))) +
  geom_col() +
  geom_text(data = . %>% filter(n >= 50), aes(label = n), hjust = 1.2) +
  geom_text(data = . %>% filter(n < 50), aes(label = n), hjust = -.2, color = "black") +
  facet_grid(cols = vars(age)) +
  labs(title = "How respondents get news, by age", subtitle = "Respondents could select multiple ways", x = NULL, y = NULL) +
  theme(axis.text.x = element_blank())
```

I didn't expect these to be so similar.

```{r mode_lang}
langmode1 <- read %>% 
  select(formats_used, language) %>% 
  filter(!is.na(formats_used), !is.na(language)) %>% 
  group_by(formats_used, language) %>% 
  count() %>% 
  mutate(formats_used = if_else(n <=2, "Other", formats_used)) %>% 
  filter(formats_used != "Other") %>% 
  group_by(formats_used, language) %>% 
  summarise(n = sum(n)) %>% 
  ungroup() %>% 
  rename(format = formats_used) %>% 
  mutate(mode = "used")

langmode1 %>% 
  ggplot(aes(x = n, y = reorder(format, n))) +
  geom_col() +
  geom_text(data = . %>% filter(n >= 50), aes(label = n), hjust = 1.2) +
  geom_text(data = . %>% filter(n < 50), aes(label = n), hjust = -.2, color = "black") +
  facet_grid(cols = vars(language)) +
  labs(title = "How respondents get news, by language spoken at home", subtitle = "Respondents could select multiple ways", x = NULL, y = NULL) +
  theme(axis.text.x = element_blank())
```

Huh, I expected more variation here, too. I guess TV and social media are really it.

```{r mode_place_of_birth}
pobmode1 <- read %>% 
  select(formats_used, place_of_birth) %>% 
  filter(!is.na(formats_used), !is.na(place_of_birth)) %>% 
  group_by(formats_used, place_of_birth) %>% 
  count() %>% 
  mutate(formats_used = if_else(n <=2, "Other", formats_used)) %>% 
  filter(formats_used != "Other") %>% 
  group_by(formats_used, place_of_birth) %>% 
  summarise(n = sum(n)) %>% 
  ungroup() %>% 
  rename(format = formats_used) %>% 
  mutate(mode = "used")

pobmode1 %>% 
  ggplot(aes(x = n, y = reorder(format, n))) +
  geom_col() +
  geom_text(data = . %>% filter(n >= 50), aes(label = n), hjust = 1.2) +
  geom_text(data = . %>% filter(n < 50), aes(label = n), hjust = -.2, color = "black") +
  facet_grid(cols = vars(place_of_birth)) +
  labs(title = "How respondents get news, by place of birth", subtitle = "Respondents could select multiple ways", x = NULL, y = NULL) +
  theme(axis.text.x = element_blank())
```

```{r mode_pob_latino}
pobmodelatino <- read %>% 
  select(formats_used, latino_by_pob) %>% 
  filter(!is.na(formats_used), !is.na(latino_by_pob)) %>% 
  group_by(formats_used, latino_by_pob) %>% 
  count() %>% 
  mutate(formats_used = if_else(n <=2, "Other", formats_used)) %>% 
  filter(formats_used != "Other") %>% 
  group_by(formats_used, latino_by_pob) %>% 
  summarise(n = sum(n)) %>% 
  ungroup() %>% 
  rename(format = formats_used) %>% 
  mutate(mode = "used")

pobmodelatino %>% 
  filter(latino_by_pob != "Not Latino") %>% 
  ggplot(aes(x = n, y = reorder(format, n))) +
  geom_col() +
  geom_text(data = . %>% filter(n >= 50), aes(label = n), hjust = 1.2) +
  geom_text(data = . %>% filter(n < 50), aes(label = n), hjust = -.2, color = "black") +
  facet_grid(cols = vars(latino_by_pob)) +
  labs(title = "How Latino respondents get news, by place of birth", subtitle = "Respondents could select multiple ways", x = NULL, y = NULL) +
  theme(axis.text.x = element_blank())
```

## Preferred language by age and ethnicity

People under 50 have a slightly stronger overall preference for bilingual content.

```{r lang_pref}
pref_age <- read %>% 
  select(age, tv_video_language, radio_audio_language, print_language) %>% 
  pivot_longer(cols = ends_with("language"), names_to = "format", values_to = "language") %>% 
  filter(!is.na(age), !is.na(format), !is.na(language)) %>% 
  mutate(format = str_remove(format, "_language")) %>% 
  group_by(age, format, language) %>% 
  count()

pref_age %>% 
  filter(!language %in% c("I don't use this format", "Other")) %>% 
  ggplot(aes(x = n, y = reorder(format, n))) +
  geom_col() +
  geom_text(data = . %>% filter(n >= 50), aes(label = n), hjust = 1.2) +
  geom_text(data = . %>% filter(n < 50), aes(label = n), hjust = -.2, color = "black") +
  facet_grid(cols = vars(age), rows = vars(language)) +
  labs(title = "Preferred language by mode, by age", x = NULL, y = NULL) +
  theme(axis.text.x = element_blank())
```

Language is so important culturally, I'm not at all surprised to see people who identify as Latino strongly preferring Spanish and bilingual content.

```{r pref_ethnicity}
pref_latino <- read %>% 
  select(latino, tv_video_language, radio_audio_language, print_language) %>% 
  pivot_longer(cols = ends_with("language"), names_to = "format", values_to = "language") %>% 
  filter(!is.na(latino), !is.na(format), !is.na(language)) %>% 
  mutate(format = str_remove(format, "_language")) %>% 
  group_by(latino, format, language) %>% 
  count()

pref_latino %>% 
  filter(!language %in% c("I don't use this format", "Other"), latino != "Opt out") %>% 
  ggplot(aes(x = n, y = reorder(format, n))) +
  geom_col() +
  geom_text(data = . %>% filter(n >= 50), aes(label = n), hjust = 1.2) +
  geom_text(data = . %>% filter(n < 50), aes(label = n), hjust = -.2, color = "black") +
  facet_grid(cols = vars(latino), rows = vars(language)) +
  labs(title = "Preferred language by mode, by ethnicity", x = NULL, y = NULL) +
  theme(axis.text.x = element_blank())
```

```{r pref_latino_pob}
pref_latinopob <- read %>% 
  select(latino_by_pob, tv_video_language, radio_audio_language, print_language) %>% 
  pivot_longer(cols = ends_with("language"), names_to = "format", values_to = "language") %>% 
  filter(!is.na(latino_by_pob), !is.na(format), !is.na(language)) %>% 
  mutate(format = str_remove(format, "_language")) %>% 
  group_by(latino_by_pob, format, language) %>% 
  count()

pref_latinopob %>% 
  filter(!language %in% c("I don't use this format", "Other"), latino_by_pob != "Not Latino") %>% 
  ggplot(aes(x = n, y = reorder(format, n))) +
  geom_col() +
  geom_text(data = . %>% filter(n >= 50), aes(label = n), hjust = 1.2) +
  geom_text(data = . %>% filter(n < 50), aes(label = n), hjust = -.2, color = "black") +
  facet_grid(cols = vars(latino_by_pob), rows = vars(language)) +
  labs(title = "Preferred language by mode for Latinos, by place of birth", x = NULL, y = NULL) +
  theme(axis.text.x = element_blank())
```

## News sources

Preferred sources is also an open text field. Mining for word clouds...

```{r mine_for_clouds}
age00_29 <- read %>% filter(age == "age00_29")
age30_49 <- read %>% filter(age == "age30_49")
age50_99 <- read %>% filter(age == "age50_99")

latino <- read %>% filter(latino == "Yes")

spn_at_home <- read %>% filter(language == "Spanish")
eng_at_home <- read %>% filter(language == "English")
both_at_home <- read %>% filter(language == "Both English and Spanish")

fblatino <- read %>% filter(latino_by_pob == "Foreign-born Latino")
uslatino <- read %>% filter(latino_by_pob == "US-born Latino")

list_age00_29 <- str_split(age00_29$open_text_media, ",| y | and | or|\\/|  ", simplify = T)
list_age30_49 <- str_split(age30_49$open_text_media, ",| y | and | or|\\/|  ", simplify = T)
list_age50_99 <- str_split(age50_99$open_text_media, ",| y | and | or|\\/|  ", simplify = T)

list_latino <- str_split(latino$open_text_media, ",| y | and | or|\\/|  ", simplify = T)

list_spn_at_home <- str_split(spn_at_home$open_text_media, ",| y | and | or|\\/|  ", simplify = T)
list_eng_at_home <- str_split(eng_at_home$open_text_media, ",| y | and | or|\\/|  ", simplify = T)
list_both_at_home <- str_split(both_at_home$open_text_media, ",| y | and | or|\\/|  ", simplify = T)

list_fblatino <- str_split(fblatino$open_text_media, ",| y | and | or|\\/|  ", simplify = T)

list_uslatino <- str_split(uslatino$open_text_media, ",| y | and | or|\\/|  ", simplify = T)

clean_clouds <- function(x){
 x %>% 
    filter(!is.na(source), source != "") %>% 
    mutate(source = str_to_upper(source)) %>%
    mutate(source = str_trim(source, side = "both")) 
}

a <- tibble(source = c(list_age00_29)) %>% clean_clouds()
b <- tibble(source = c(list_age30_49)) %>% clean_clouds()
c <- tibble(source = c(list_age50_99)) %>% clean_clouds()
d <- tibble(source = c(list_latino)) %>% clean_clouds()
e <- tibble(source = c(list_spn_at_home)) %>% clean_clouds()
f <- tibble(source = c(list_eng_at_home)) %>% clean_clouds()
g <- tibble(source = c(list_both_at_home)) %>% clean_clouds()
h <- tibble(source = c(list_fblatino)) %>% clean_clouds()
i <- tibble(source = c(list_uslatino)) %>% clean_clouds()

cloud_a <- a %>% group_by(source) %>% count()
cloud_b <- b %>% group_by(source) %>% count()
cloud_c <- c %>% group_by(source) %>% count()
cloud_d <- d %>% group_by(source) %>% count()
cloud_e <- e %>% group_by(source) %>% count()
cloud_f <- f %>% group_by(source) %>% count()
cloud_g <- g %>% group_by(source) %>% count()
cloud_h <- h %>% group_by(source) %>% count()
cloud_i <- i %>% group_by(source) %>% count()
```

By age, young people put fewer answers in, older people put a lot more

```{r clouds_age}
library(ggwordcloud)

set.seed(13)

ggplot(cloud_a, aes(label = source, size = n+3, color = n)) +
  geom_text_wordcloud_area(family = "Barlow Semi Condensed", eccentricity = .6) +
  scale_size_area(max_size = 10) +
  theme_minimal() +
  scale_color_gradient(high = qual_pal[1], low = qual_pal[7]) +
  labs(title = "Sources preferred by people under 30")

ggplot(cloud_b, aes(label = source, size = n+3, color = n)) +
  geom_text_wordcloud_area(family = "Barlow Semi Condensed", eccentricity = .6) +
  scale_size_area(max_size = 10) +
  theme_minimal() +
  scale_color_gradient(high = qual_pal[1], low = qual_pal[7]) +
  labs(title = "Sources preferred by people 30-49")

ggplot(cloud_c, aes(label = source, size = n+3, color = n)) +
  geom_text_wordcloud_area(family = "Barlow Semi Condensed", eccentricity = .6) +
  scale_size_area(max_size = 10) +
  theme_minimal() +
  scale_color_gradient(high = qual_pal[1], low = qual_pal[7]) +
  labs(title = "Sources preferred by people 50+")
```

Telemundo far and away the favored source for Latinos

```{r clouds_ethnicity}
ggplot(cloud_d, aes(label = source, size = n+3, color = n)) +
  geom_text_wordcloud_area(family = "Barlow Semi Condensed", eccentricity = .6) +
  scale_size_area(max_size = 10) +
  theme_minimal() +
  scale_color_gradient(high = qual_pal[1], low = qual_pal[7]) +
  labs(title = "Sources preferred by Latinos")
```

Facebook stands out among Spanish speakers

```{r clouds_language}
ggplot(cloud_e, aes(label = source, size = n+3, color = n)) +
  geom_text_wordcloud_area(family = "Barlow Semi Condensed", eccentricity = .6) +
  scale_size_area(max_size = 10) +
  theme_minimal() +
  scale_color_gradient(high = qual_pal[1], low = qual_pal[7]) +
  labs(title = "Sources preferred by Spanish-speakers at home")

ggplot(cloud_f, aes(label = source, size = n+3, color = n)) +
  geom_text_wordcloud_area(family = "Barlow Semi Condensed", eccentricity = .6) +
  scale_size_area(max_size = 10) +
  theme_minimal() +
  scale_color_gradient(high = qual_pal[1], low = qual_pal[7]) +
  labs(title = "Sources preferred by English-speakers at home")

ggplot(cloud_g, aes(label = source, size = n+3, color = n)) +
  geom_text_wordcloud_area(family = "Barlow Semi Condensed", eccentricity = .6) +
  scale_size_area(max_size = 10) +
  theme_minimal() +
  scale_color_gradient(high = qual_pal[1], low = qual_pal[7]) +
  labs(title = "Sources preferred by bilingual people at home")
```

Foreign-born Latinos use Facebook more (more access to news sources from abroad?)

```{r clouds_latinopob}
ggplot(cloud_h, aes(label = source, size = n+3, color = n)) +
  geom_text_wordcloud_area(family = "Barlow Semi Condensed", eccentricity = .6) +
  scale_size_area(max_size = 10) +
  theme_minimal() +
  scale_color_gradient(high = qual_pal[1], low = qual_pal[7]) +
  labs(title = "Sources preferred by Foreign-born Latinos")

ggplot(cloud_i, aes(label = source, size = n+3, color = n)) +
  geom_text_wordcloud_area(family = "Barlow Semi Condensed", eccentricity = .6) +
  scale_size_area(max_size = 10) +
  theme_minimal() +
  scale_color_gradient(high = qual_pal[1], low = qual_pal[7]) +
  labs(title = "Sources preferred by US-born Latinos")
```
